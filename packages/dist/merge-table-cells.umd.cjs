(function(a,o){typeof exports=="object"&&typeof module<"u"?module.exports=o():typeof define=="function"&&define.amd?define(o):(a=typeof globalThis<"u"?globalThis:a||self,a.mergeTableCells=o())})(this,function(){"use strict";var T=Object.defineProperty;var D=(a,o,d)=>o in a?T(a,o,{enumerable:!0,configurable:!0,writable:!0,value:d}):a[o]=d;var b=(a,o,d)=>D(a,typeof o!="symbol"?o+"":o,d);function a(l,n){const{count:e=0,children:t=new Map}=l.get(n)||{};return l.set(n,{count:e+1,children:t}),l.get(n)}function o(l){const n=[];if(l.length<2)return n;for(let e=0;e<l.length;e++)for(let t=e+1;t<l.length;t++){const u=l.slice(e,t+1);u.length>=2&&n.push(u)}return n.sort((e,t)=>t.length-e.length),n}class d{constructor(n){b(this,"mergeKeys",{rowspan:[],colspan:[]});b(this,"alias","_span");const e=Array.isArray(n)?{rowspan:n,colspan:n}:n;this.mergeKeys.rowspan=(e==null?void 0:e.rowspan)||[],this.mergeKeys.colspan=(e==null?void 0:e.colspan)||[]}format(n,e){const{rowspan:t,colspan:u}=this.mergeKeys,g=(s,f)=>{if(typeof e=="function")return e(s,f);for(let p of t){const h=String(s[p]??""),w=String(f[p]??"");if(h!==w)return h.localeCompare(w)}return 0},y=[...n].sort(g),K=y.reduce((s,f)=>(t.reduce((p,h)=>a(p.children||s,f[h]),{}),s),new Map),v=o(u);return y.map((s,f,p)=>{s[this.alias]={rowspan:{},colspan:{}};const h=v.find(r=>r.every((c,i)=>i===0?!0:s[c]===s[r[i-1]]))||[];h.forEach((r,c)=>{s[this.alias].colspan[r]=c===0?h.length:0});const w=t.reduce((r,c,i)=>(i===0?r.push(K.get(s[c])):r.push(r[i-1].children.get(s[c])),r),[]);if(f===0)return t.forEach((r,c)=>{s[this.alias].rowspan[r]=w[c].count}),s;const M=r=>s[r]===p[f-1][r];return t.reduce((r,c,i)=>{const C=r&&M(c);return s[this.alias].rowspan[c]=C?0:w[i].count,C},!0),s})}span(n,e){const t=e[this.alias]||{},u={rowspan:1,colspan:1};return Object.keys(u).forEach(g=>{({}).hasOwnProperty.call(t[g]||{},n)&&(u[g]=t[g][n])}),u}}return d});
